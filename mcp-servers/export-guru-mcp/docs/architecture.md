# Export Guru MCP Architecture

This document outlines the architecture of the Export Guru MCP (Model-Controller-Proxy) server, which serves as a middleware layer between the frontend and various data sources, including APIs, databases, and LLMs.

## Overview

The Export Guru MCP follows a modular architecture that separates concerns and enables testing in isolation. The architecture is designed to be extensible, maintainable, and scalable.

## Key Components

### 1. Data Access Layer (Connectors)

The connectors are responsible for retrieving data from various sources:

- `regulatory-db.ts`: Connects to the regulatory database
- `trade-map.ts`: Connects to the Trade Map API
- `wits.ts`: Connects to the WITS API
- `comtrade.ts`: Connects to the Comtrade API
- `internal-db.ts`: Connects to the internal database

Connectors implement caching, error handling, and retry logic to ensure reliable data access.

### 2. Tool Layer

The tools provide business logic and expose functions for accessing and filtering data:

- `regulatory.ts`: Tools for accessing and filtering regulatory data
- `market-intelligence.ts`: Tools for market intelligence analysis
- `analyze-tariffs.ts`: Tools for tariff analysis
- `sql.ts`: Tools for SQL generation
- `report.ts`: Tools for report generation
- `business-analysis/`: Tools for business analysis
  - `export-readiness-assessment.ts`: Export readiness assessment
  - `hs-mapper.ts`: HS code mapping
  - `product-categorization.ts`: Product categorization
  - `webscraper-analyzer.ts`: Website data analysis

### 3. Utility Layer

The utilities provide common functionality used across the application:

- `cache-manager.ts`: Caching utilities
- `data-pipeline.ts`: Data pipeline utilities
- `llm-helpers.ts`: LLM integration utilities
- `monitoring.ts`: Monitoring utilities
- `validation.ts`: Data validation utilities

### 4. Integration Layer

The integration layer connects the MCP with other components:

- `assessment-integration.ts`: Integration with assessment flow
- `dashboard-connector.ts`: Integration with dashboards
- `frontend-transformer.ts`: Data transformation for frontend

### 5. Type Layer

The types provide structured interfaces for data:

- `regulatory.ts`: Regulatory data types
- `market.ts`: Market data types
- `business.ts`: Business data types
- `config.ts`: Configuration types
- `common.ts`: Common types

## Data Flow Patterns

The MCP implements several standard data flow patterns:

### 1. Direct Data Access Pattern

```
Frontend -> MCP -> Connector -> Data Source -> Connector -> MCP -> Frontend
```

Used for simple data retrieval where no LLM processing is required.

### 2. LLM Enhancement Pattern

```
Frontend -> MCP -> Connector -> Data Source -> Connector -> MCP -> LLM -> MCP -> Frontend
```

Used when data from a connector needs to be enhanced with LLM-generated insights.

### 3. LLM Generation Pattern

```
Frontend -> MCP -> LLM -> MCP -> Frontend
```

Used when data is not available in connectors and needs to be generated by an LLM.

### 4. Hybrid Processing Pattern

```
Frontend -> MCP -> [Multiple Connectors] -> MCP -> LLM -> MCP -> Frontend
```

Used for complex analyses requiring multiple data sources and LLM processing.

## Configuration

The MCP is configured through environment variables and the `config.ts` file, which includes:

- Server configuration (port, debug mode)
- Connector configuration (API keys, endpoints)
- LLM configuration (model, parameters)
- Caching configuration (TTL, max size)

## Error Handling

The MCP implements comprehensive error handling:

- Connector-level error handling with retries
- Tool-level error handling with fallbacks
- LLM error handling with timeouts and retries
- Validation to ensure data integrity

## Monitoring

The MCP includes monitoring utilities to track:

- Response times
- Error rates
- Cache hit rates
- LLM usage
- API calls
- Data quality

## Security

The MCP implements security measures:

- API key management
- Input validation
- Rate limiting
- Error message sanitization

## Deployment

The MCP can be deployed as a standalone server or as part of a larger application. It is designed to be containerized and can be deployed to various environments.

## Future Enhancements

Future enhancements to the architecture include:

- Additional connectors for more data sources
- Enhanced LLM integration with more sophisticated prompts
- Improved monitoring and telemetry
- More comprehensive validation
- Enhanced security measures 